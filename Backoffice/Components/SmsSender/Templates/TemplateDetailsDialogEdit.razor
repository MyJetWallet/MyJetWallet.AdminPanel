@using Service.SmsSender.Domain.Models
@using Service.SmsSender.Domain.Models.Enums

<BaseTwoButtonsDialog Caption=@(Template.Id.ToString())
                      OnClose="OnClose"
                      YesButtonCaption="Save"
                      NoButtonCaption="Close"
                      OnSubmit="OnSubmit">
    <table>
        <tr>
            <td>
                <table>
                    @*<tr>
                        <td>Id</td>
                        <td class="float-left">
                            @Template.Id
                        </td>
                    </tr>*@
                    <tr>
                        <td>Default Lang</td>
                        <td class="float-left">
                            <input type="text" class="form-control" @bind="Template.DefaultLang" />
                        </td>
                    </tr>
                    @foreach (var (lang, _) in Template.BrandLangBodies.FirstOrDefault().LangBodies)
                    {
                        @*<tr>
                            <td>Lang</td>
                            <td class="float-left">
                                @lang
                            </td>
                        </tr>*@
                        <tr>
                            @if (lang == Template.DefaultLang.ToString())
                            {
                                <td>Default (@lang) Body</td>
                            }
                            else
                            {
                                <td>@lang Body</td>
                            }
                            <td class="float-left">
                                <input type="text" class="form-control" @bind="Template.BrandLangBodies.FirstOrDefault().LangBodies[lang]" />
                            </td>
                        </tr>
                    }
                </table>
            </td>
        </tr>
    </table>
</BaseTwoButtonsDialog>

@code {

    [Parameter]
    public TemplateEnum TemplateId { get; set; }

    [Parameter]
    public SmsTemplate Template { get; set; } = new();

    [Parameter]
    public bool IsCreate { get; set; }

    [Parameter]
    public EventCallback OnCloseCallback { get; set; }

    [Parameter]
    public EventCallback<SmsTemplate> OnCreateCallback { get; set; }

    [Parameter]
    public EventCallback<SmsTemplate> OnUpdateCallback { get; set; }

    private void OnClose()
    {
        OnCloseCallback.InvokeAsync();
    }

    private async Task OnSubmit()
    {
        await OnUpdateCallback.InvokeAsync(Template);
    }

    protected override void OnInitialized()
    {
        Template.Id = TemplateId;

        base.OnInitialized();
    }
}